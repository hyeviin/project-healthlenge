<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
th:replace="~{layout/admin/headerFooter :: layout(~{::head}, ~{::main})}">
	<head>
		<title>카테고리 관리</title>
	    <link rel="stylesheet" href="/css/admin/list.css">
	</head>
	<main>
		<h1>메인컨텐츠</h1>
		<div class="wrap">
			<section class="table-tilte flex between">
				<h2>카테고리 관리</h2>
				<a href="/admin/category/write">등록</a>
			</section>
			<section class="main">
				<div class="flex">
					<p class="num-size">순서</p>
					<p class="img-size">이미지</p>
					<p class="title-size">카테고리명</p>
					<p class="title-size">적용여부</p>
					<p class="title-size">관리</p>
				</div>
				<div>
					<ul>
						<li class="vimg flex acenter" th:each="dto, i : ${category}">
							<p class="vno">[[${dto.caNo}]]</p>
							<p class="num-size">[[${dto.num}]]</p>
							<div class="bg img-size" th:style="|background-image: url(${dto.url+dto.fileName});|"></div>
							<span th:utext="${dto.name}" class="title title-size"></span>
							<div class="title-size flex center acenter">
								<label th:for="|cb-isShow-${i.count}|" class="flex acenter"><input th:id="|cb-isShow-${i.count}|" class="cb-isShow" type="checkbox" checked="checked" th:checked="${dto.isShow}">적용</label>
							</div>
							<button type="button" class="title-size list-btn">삭제</button>
						</li>
					</ul>
					<script type="text/javascript">
					$(function(){
						$(".cb-isShow").change(function(){
							//alert($(this).attr("checked"));
							var no=$(this).parents("li").find(".vno").text();
							var isShow = ($(this).prop("checked"));
							var token = $("meta[name='_csrf']").attr("content");
			    			var header = $("meta[name='_csrf_header']").attr("content");
			    			
			    			$.ajax({
			    				beforeSend:function(xhr){xhr.setRequestHeader(header, token);},
								url:"/admin/category/" + no + "/isShow",
								type:"post",
								data:{"isShow":isShow},
								success:function(result){
									if(result){
										alert("수정완료");
									}
								}
							});
						
						});
						
						$(function(){
							$(".list-btn").click(function(){
								var no=$(this).parents("li").find(".vno").text();
								var token = $("meta[name='_csrf']").attr("content");
				    			var header = $("meta[name='_csrf_header']").attr("content");
				    			
				    			$.ajax({
				    				beforeSend:function(xhr){xhr.setRequestHeader(header, token);},
									url:"/admin/category/" + no + "/delect",
									type:"post",
									success:function(result){
										if(result){
											let url= "/admin/category";
											location.replace(url);
											alert("삭제완료");
										}
									}
								});
				    			
							});
						});
					});
					</script>
				</div>
			</section>
		</div>
	</main>
</html>

